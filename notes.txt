Use dependency injection to test functions independently.

Focus on correctness of logic without relying on real system calls.